(this["webpackJsonpreact-ts-app"]=this["webpackJsonpreact-ts-app"]||[]).push([[0],{41:function(e,t,n){e.exports=n(71)},69:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),o=n(15),r=n.n(o),i=n(2),l=n(8),u=n(13),m=n(34),s={title:"\u5c0f\u7c73\u4e66\u57ce",currentId:0,isRealScroll:!0,list:[],myBooks:[]},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_STATE":var n=JSON.parse(JSON.stringify(e));return n[t.key]=t.value,n;default:return e}},f=Object(u.c)({book:d}),E=Object(u.d)(f,Object(u.a)(m.a));E.subscribe((function(){E.getState()}));var v=E,p=n(35),b=n(36),h=n(40),k=n(39),y=n(10),g=n(7),N=function(e){var t=e.name,n=void 0===t?"zhanwei":t,a=e.className,o=void 0===a?"":a,r=e.onClick,i=void 0===r?function(){}:r;return c.a.createElement("span",{className:"icon iconfont icon-".concat(n," ").concat(o),onClick:function(e){return i(e,1)}})},S=n(20),O=n.n(S),j=n(37),T=n(17),C=n.n(T),w={login:"/api/login",list:"/api/list",myBooks:"/api/my_books",detail:"/api/detail/"};C.a.interceptors.request.use((function(e){return e.headers.token=localStorage.getItem("token"),e}),(function(e){return console.log("\u5bf9\u8bf7\u6c42\u9519\u8bef\u505a\u4e9b\u4ec0\u4e48",e),Promise.reject(e)})),C.a.interceptors.response.use((function(e){return 400===e.data.code&&alert(e.data.message),e}),(function(e){return console.log("\u5bf9\u54cd\u5e94\u9519\u8bef\u505a\u4e9b\u4ec0\u4e48"),Promise.reject(e)}));var x,B,D=function(){var e=Object(j.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C()(t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I={login:function(e){return D({url:w.login,data:e,method:"post"})},list:function(){return D({url:w.list})},myBooks:function(e,t){return D({url:w.myBooks,data:e,method:t})},getDetail:function(e){return D({url:w.detail+e})}},_=function(e){var t=Object(a.useState)("admin"),n=Object(g.a)(t,2),o=n[0],r=n[1],i=Object(a.useState)("123456"),l=Object(g.a)(i,2),u=l[0],m=l[1],s=Object(a.useState)(!1),d=Object(g.a)(s,2),f=d[0],E=d[1],v=function(){I.login({username:o,password:u}).then((function(t){200===t.code&&(localStorage.setItem("token",t.data.username),e.history.push("/index/home"))}))};return c.a.createElement("div",null,c.a.createElement("div",null,c.a.createElement("input",{value:o,onChange:function(e){return r(e.target.value)},placeholder:"\u8bf7\u8f93\u5165\u7528\u6237\u540d",autoFocus:!0})),c.a.createElement("div",null,c.a.createElement("input",{value:u,onChange:function(e){return m(e.target.value)},onKeyUp:function(e){return function(e){13===e.keyCode&&v()}(e)},placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",type:f?"text":"password"}),c.a.createElement(N,{name:f?"show":"hide",onClick:function(e,t){E(!f)},className:"m-login-icon"})),c.a.createElement("button",{onClick:function(){return v()}},"\u767b\u5f55"))},A=Object(i.b)((function(e){return{title:e.book.title}}),(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))((function(e){var t=e.title;return c.a.createElement("div",{className:"m-header"},t)})),R=function(e){var t=e.count,n=e.children;return t>99&&(t="99+"),c.a.createElement("span",{className:"m-badge-wrap"},("string"===typeof t||t>0)&&c.a.createElement("span",{className:"m-badge"},t),n)},J=function(){return function(e){I.list().then((function(t){200===t.code&&e({type:"SET_STATE",key:"list",value:t.data})}))}},P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get",n=arguments.length>2?arguments[2]:void 0;return function(a){I.myBooks(e,t).then((function(e){200===e.code&&(a({type:"SET_STATE",key:"myBooks",value:e.data}),n&&n())}))}},W=Object(i.b)((function(e){return{myBooks:e.book.myBooks}}),(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))((function(e){var t=e.myBooks,n=e.onDispatch,o=t.reduce((function(e,t){return e+t.count}),0);return Object(a.useEffect)((function(){n(P())}),[n]),c.a.createElement("div",{className:"m-footer"},c.a.createElement(l.b,{to:"/index/home",className:"m-footer-item",onClick:function(){}},c.a.createElement(N,{name:"home",className:"m-footer-icon"}),c.a.createElement("div",{className:"m-footer-text"},"\u9996\u9875")),c.a.createElement(l.b,{to:"/index/my_books",className:"m-footer-item",onClick:function(){}},c.a.createElement(R,{count:o},c.a.createElement(N,{name:"shubao",className:"m-footer-icon"})),c.a.createElement("div",{className:"m-footer-text"},"\u4e66\u5305")),c.a.createElement(l.b,{to:"/index/me",className:"m-footer-item",onClick:function(){}},c.a.createElement(N,{name:"me",className:"m-footer-icon"}),c.a.createElement("div",{className:"m-footer-text"},"\u6211\u7684")))})),q=Object(i.b)((function(e){return{list:e.book.list,currentId:e.book.currentId}}),(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))((function(e){var t=e.list,n=e.currentId,a=t.map((function(t){return c.a.createElement("div",{key:t.id,className:"m-sidebar-item ".concat(n===t.id?"active":""),onClick:function(){return n=t.id,e.onSetState("currentId",n),e.onSetState("isRealScroll",!1),document.getElementById(n+"").scrollIntoView({block:"start",behavior:"smooth"}),clearTimeout(x),void(x=setTimeout((function(){e.onSetState("isRealScroll",!0)}),1e3));var n}},t.title)}));return c.a.createElement("div",{className:"m-sidebar"},a)})),z=n(11),F=function(e){for(var t=e.count,n=[],a=0;a<5;a++)n.push(c.a.createElement(N,{name:"star",key:a,className:"m-star ".concat(a<t?"active":"")}));return c.a.createElement("div",null,n)},K=function(e){var t=e.visible,n=e.title,a=e.children;return c.a.createElement("div",{className:"m-dialog-wrap "+(t?"active":"")},c.a.createElement("div",{className:"m-dialog"},c.a.createElement("div",{className:"m-dialog-header"},c.a.createElement("div",{className:"m-dialog-title"},n),c.a.createElement(N,{name:"guanbi",className:"m-dialog-close",onClick:e.onCancel})),c.a.createElement("div",{className:"m-dialog-content"},a),c.a.createElement("div",{className:"m-dialog-footer"},c.a.createElement("button",{className:"m-btn",onClick:e.onCancel},"\u53d6\u6d88"),c.a.createElement("button",{className:"m-btn",onClick:e.onOk},"\u786e\u5b9a"))))},U=Object(i.b)((function(e){return{list:e.book.list,currentId:e.book.currentId,isRealScroll:e.book.isRealScroll}}),(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))(Object(y.g)((function(e){var t=e.list,n=e.isRealScroll,o=Object(a.useState)(!1),r=Object(g.a)(o,2),i=r[0],l=r[1],u=Object(a.useState)({checked:!0,count:1,id:1,title:"",avatar:"",price:0,stars:0}),m=Object(g.a)(u,2),s=m[0],d=m[1],f=function(){l(!1)};Object(a.useEffect)((function(){(B=Array.from(document.getElementsByClassName("js-category")).map((function(e){return e.offsetTop}))).push(1/0)}),[e.list]);var E=t.map((function(t){return c.a.createElement("div",{key:t.id,id:t.id+"",className:"js-category"},c.a.createElement("div",{className:"m-category-title"},t.title),t.list.map((function(t){return c.a.createElement("div",{key:t.id,className:"m-list-item",onClick:function(){return n=t.id,void e.history.push("/detail/".concat(n));var n}},c.a.createElement("div",{className:"m-img-wrap"},c.a.createElement("img",{src:t.avatar,alt:t.title,className:"m-img"})),c.a.createElement("div",{className:"m-list-info"},t.title,c.a.createElement(F,{count:t.stars}),c.a.createElement("button",{className:"m-btn",onClick:function(e){return function(e,t){e.stopPropagation(),t.checked=!0,t.count=1,d(t),l(!0)}(e,t)}},"\u6dfb\u52a0")))})))}));return c.a.createElement("div",{className:"m-list",onScroll:function(t){return function(t){var a=t.target.scrollTop+40;if(n)for(var c=0;c<B.length-1;c++)B[c]<=a&&a<B[c+1]&&e.onSetState("currentId",c)}(t)}},E,c.a.createElement(K,{title:"\u6dfb\u52a0",visible:i,onOk:function(){e.onDispatch(P({book:s},"post",f))},onCancel:function(){return f()}},c.a.createElement("div",{className:"m-add-wrap"},c.a.createElement("div",{className:"m-add-info"},c.a.createElement("button",{className:"m-btn",onClick:function(){s.count>1&&(s.count--,d(Object(z.a)({},s)))}},"-"),c.a.createElement("input",{value:s.count,placeholder:"\u6570\u91cf",className:"m-input",onChange:function(e){return function(e){var t=parseInt(e.target.value.replace(/[^\d]/g,""));0===t&&(t=1),s.count=t,d(Object(z.a)({},s))}(e)}}),c.a.createElement("button",{className:"m-btn",onClick:function(){return s.count++,void d(Object(z.a)({},s))}},"+")))))}))),V=Object(i.b)((function(){return{}}),(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))((function(e){var t=e.onDispatch;return Object(a.useEffect)((function(){t(J())}),[t]),c.a.createElement("div",{className:"m-main m-home"},c.a.createElement(q,null),c.a.createElement(U,null))})),$=Object(i.b)((function(e){return{myBooks:e.book.myBooks}}),(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))((function(e){var t=e.book,n=e.onDispatch;return c.a.createElement("div",{className:"m-my-books-item"},c.a.createElement("div",{className:"m-my-books-checkbox-wrap"},c.a.createElement("input",{type:"checkbox",checked:t.checked,onChange:function(e){return function(e,t){n(P({id:e,operation:"checked",checked:t.target.checked},"patch"))}(t.id,e)},className:"m-my-books-checkbox"})),c.a.createElement("div",{className:"m-my-books-img-wrap"},c.a.createElement("img",{src:t.avatar,className:"m-my-books-img",alt:t.title})),c.a.createElement("div",{className:"m-my-books-info"},c.a.createElement("div",null,t.title),c.a.createElement("div",null,"\uffe5",t.price),c.a.createElement("div",{className:"m-add-info"},c.a.createElement("button",{className:"m-btn",onClick:function(){return e=t.id,void n(P({id:e,operation:"add"},"patch"));var e}},"\u51cf"),c.a.createElement("input",{type:"text",value:t.count,placeholder:"\u6570\u91cf",className:"m-input",onChange:function(e){return function(e,t){var a=parseInt(t.target.value.replace(/[^\d]/g,""));0===a&&(a=1),n(P({id:e,operation:"inputCount",count:a},"patch"))}(t.id,e)}}),c.a.createElement("button",{className:"m-btn",onClick:function(){return e=t.id,void n(P({id:e,operation:"add"},"patch"));var e}},"\u52a0"),c.a.createElement("button",{className:"m-btn",onClick:function(){return e=[t.id],void n(P({ids:e},"delete"));var e}},"\u5220\u9664"))))})),G=Object(i.b)((function(e){return{myBooks:e.book.myBooks}}),(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))((function(e){var t=e.myBooks,n=e.onDispatch,o=Object(a.useState)(!1),r=Object(g.a)(o,2),i=r[0],l=r[1],u=function(){l(!1)},m=t.filter((function(e){return e.checked})).reduce((function(e,t){return e+t.count*t.price}),0),s=t.every((function(e){return e.checked})),d=t.map((function(e){return c.a.createElement($,{key:e.id,book:e})}));return c.a.createElement("div",{className:"m-main"},t.length>0?c.a.createElement("div",{className:"m-my-books"},c.a.createElement("div",{className:"m-my-books-content"},d),c.a.createElement("div",{className:"m-my-books-footer"},c.a.createElement("label",null,c.a.createElement("input",{type:"checkbox",checked:s,onChange:function(e){return function(e){n(P({operation:"checkedAll",checked:e.target.checked},"patch"))}(e)}}),c.a.createElement("span",null,"\u5168\u9009")),c.a.createElement("button",{onClick:function(){0===t.filter((function(e){return e.checked})).length?alert("\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u5546\u54c1\u54e6~"):l(!0)}},"\u5220\u9664"),c.a.createElement("span",null,"\u5408\u8ba1: \uffe5",m))):c.a.createElement("div",{className:"m-my-books-empty"},"\u8d2d\u7269\u8f66\u7a7a\u7a7a\u5982\u4e5f~"),c.a.createElement(K,{visible:i,title:"\u5220\u9664",onOk:function(){return function(){var e=t.filter((function(e){return e.checked})).map((function(e){return e.id}));n(P({ids:e},"delete",(function(){u()})))}()},onCancel:function(){return u()}},c.a.createElement("div",{className:"m-my-books-delete-dialog-info"},"\u60a8\u786e\u5b9a\u8981\u5220\u9664\u9009\u4e2d\u7684\u5546\u54c1\u5417\uff1f")))})),H=function(){return c.a.createElement("div",{className:"m-main"},"\u4e2a\u4eba\u4e2d\u5fc3")},L=Object(i.b)((function(){return{}}),(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))((function(e){var t=function(t,n){return setTimeout((function(){e.onSetState("title",n)})),t};return c.a.createElement("div",{className:"m-wrap"},c.a.createElement(A,null),c.a.createElement(y.d,null,c.a.createElement(y.b,{path:"/index/home",render:function(){return t(c.a.createElement(V,null),"\u5c0f\u7c73\u4e66\u57ce")}}),c.a.createElement(y.b,{path:"/index/my_books",render:function(){return t(c.a.createElement(G,null),"\u6211\u7684\u4e66\u5305")}}),c.a.createElement(y.b,{path:"/index/me",render:function(){return t(c.a.createElement(H,null),"\u4e2a\u4eba\u4e2d\u5fc3")}})),c.a.createElement(W,null))})),M=Object(y.g)((function(e){var t=e.title;return c.a.createElement("div",{className:"m-detail-header"},c.a.createElement(N,{name:"back",className:"m-detail-header-icon",onClick:function(){e.history.go(-1)}}),c.a.createElement("div",{className:"m-detail-header-info"},t),c.a.createElement(N,{name:"fenxiang",className:"m-detail-header-icon"}),c.a.createElement(N,{name:"more",className:"m-detail-header-icon"}))})),Q=Object(i.b)(null,(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))((function(e){var t=Object(a.useState)({count:1}),n=Object(g.a)(t,2),o=n[0],r=n[1];return Object(a.useEffect)((function(){var t=e.match.params.id;I.getDetail(t).then((function(e){if(200===e.code){var t=e.data;t.count=1,t.checked=!0,r(t)}}))}),[e]),c.a.createElement("div",null,c.a.createElement(M,{title:o.title}),c.a.createElement("div",{className:"m-detail-img-wrap"},c.a.createElement("img",{src:o.avatar,alt:o.title})),c.a.createElement("div",null,c.a.createElement("div",{className:"m-add-info"},c.a.createElement("button",{className:"m-btn",onClick:function(){o.count>1&&(o.count--,r(Object(z.a)({},o)))}},"-"),c.a.createElement("input",{value:o.count,placeholder:"\u6570\u91cf",className:"m-input",onChange:function(e){return function(e){var t=parseInt(e.target.value.replace(/[^\d]/g,""));0===t&&(t=1),o.count=t,r(Object(z.a)({},o))}(e)}}),c.a.createElement("button",{className:"m-btn",onClick:function(){return o.count++,void r(Object(z.a)({},o))}},"+"),c.a.createElement("button",{className:"m-btn",onClick:function(){e.onDispatch(P({book:o},"post",(function(){e.history.push("/index/my_books")})))}},"\u6dfb\u52a0"))))})),X=function(e){Object(h.a)(n,e);var t=Object(k.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(b.a)(n,[{key:"render",value:function(){return c.a.createElement(y.d,null,c.a.createElement(y.a,{from:"/",to:"/login",exact:!0}),c.a.createElement(y.b,{path:"/login",render:function(e){return c.a.createElement(_,e)}}),c.a.createElement(y.b,{path:"/index",component:L}),c.a.createElement(y.b,{path:"/detail/:id",component:Q}))}}]),n}(a.Component);n(69),n(70),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(c.a.createElement(i.a,{store:v},c.a.createElement(l.a,null,c.a.createElement(X,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[41,1,2]]]);
//# sourceMappingURL=main.517e76e2.chunk.js.map