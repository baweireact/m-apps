(this["webpackJsonpreact-ts-app"]=this["webpackJsonpreact-ts-app"]||[]).push([[0],{41:function(e,t,n){e.exports=n(71)},69:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),o=n(14),r=n.n(o),i=n(2),l=n(8),u=n(12),s=n(34),m={title:"\u5c0f\u7c73\u4e66\u57ce",currentId:0,isRealScroll:!0,list:[],myBooks:[]},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_STATE":var n=JSON.parse(JSON.stringify(e));return n[t.key]=t.value,n;default:return e}},d=Object(u.c)({book:f}),E=Object(u.d)(d,Object(u.a)(s.a));E.subscribe((function(){var e=E.getState();console.log(e)}));var v=E,p=n(35),b=n(36),h=n(40),k=n(39),S=n(9),g=n(10),y=function(e){var t=e.name,n=e.className,a=void 0===n?"":n,o=e.onClick,r=void 0===o?function(){}:o;return c.a.createElement("span",{className:"icon iconfont icon-".concat(t," ").concat(a),onClick:function(e){return r(e,1)}})},N=n(20),j=n.n(N),O=n(37),T=n(16),C=n.n(T),w={login:"/api/login",list:"/api/list",myBooks:"/api/my_books",detail:"/api/detail/"};C.a.interceptors.request.use((function(e){return e.headers.token=localStorage.getItem("token"),e}),(function(e){return console.log("\u5bf9\u8bf7\u6c42\u9519\u8bef\u505a\u4e9b\u4ec0\u4e48",e),Promise.reject(e)})),C.a.interceptors.response.use((function(e){return 400===e.data.code&&alert(e.data.message),e}),(function(e){return console.log("\u5bf9\u54cd\u5e94\u9519\u8bef\u505a\u4e9b\u4ec0\u4e48"),Promise.reject(e)}));var x,I,_=function(){var e=Object(O.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C()(t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A={login:function(e){return _({url:w.login,data:e,method:"post"})},list:function(){return _({url:w.list})},myBooks:function(e,t){return _({url:w.myBooks,data:e,method:t})},getDetail:function(e){return _({url:w.detail+e})}},B=function(e){var t=Object(a.useState)("admin"),n=Object(g.a)(t,2),o=n[0],r=n[1],i=Object(a.useState)("123456"),l=Object(g.a)(i,2),u=l[0],s=l[1],m=Object(a.useState)(!1),f=Object(g.a)(m,2),d=f[0],E=f[1],v=function(){A.login({username:o,password:u}).then((function(t){200===t.code&&(localStorage.setItem("token",t.data.username),e.history.push("/index/home"))}))};return c.a.createElement("div",null,c.a.createElement("div",null,c.a.createElement("input",{value:o,onChange:function(e){return r(e.target.value)},placeholder:"\u8bf7\u8f93\u5165\u7528\u6237\u540d",autoFocus:!0})),c.a.createElement("div",null,c.a.createElement("input",{value:u,onChange:function(e){return s(e.target.value)},onKeyUp:function(e){return function(e){13===e.keyCode&&v()}(e)},placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",type:d?"text":"password"}),c.a.createElement(y,{name:d?"show":"hide",onClick:function(e,t){E(!d)},className:"m-login-icon"})),c.a.createElement("button",{onClick:function(){return v()}},"\u767b\u5f55"))},D=Object(i.b)((function(e){return{title:e.book.title}}),(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))((function(e){var t=e.title;return c.a.createElement("div",{className:"m-header"},t)})),R=Object(i.b)((function(){return{}}),(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))((function(e){return c.a.createElement("div",{className:"m-footer"},c.a.createElement(l.b,{to:"/index/home",className:"m-footer-item",onClick:function(){}},c.a.createElement(y,{name:"home",className:"m-footer-icon"}),c.a.createElement("div",{className:"m-footer-text"},"\u9996\u9875")),c.a.createElement(l.b,{to:"/index/my_books",className:"m-footer-item",onClick:function(){}},c.a.createElement(y,{name:"shubao",className:"m-footer-icon"}),c.a.createElement("div",{className:"m-footer-text"},"\u4e66\u5305")),c.a.createElement(l.b,{to:"/index/me",className:"m-footer-item",onClick:function(){}},c.a.createElement(y,{name:"me",className:"m-footer-icon"}),c.a.createElement("div",{className:"m-footer-text"},"\u6211\u7684")))})),J=Object(i.b)((function(e){return{list:e.book.list,currentId:e.book.currentId}}),(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))((function(e){var t=e.list,n=e.currentId,a=t.map((function(t){return c.a.createElement("div",{key:t.id,className:"m-sidebar-item ".concat(n===t.id?"active":""),onClick:function(){return n=t.id,e.onSetState("currentId",n),e.onSetState("isRealScroll",!1),document.getElementById(n+"").scrollIntoView({block:"start",behavior:"smooth"}),clearTimeout(x),void(x=setTimeout((function(){e.onSetState("isRealScroll",!0)}),1e3));var n}},t.title)}));return c.a.createElement("div",{className:"m-sidebar"},a)})),P=n(17),W=function(e){for(var t=e.count,n=[],a=0;a<5;a++)n.push(c.a.createElement(y,{name:"star",key:a,className:"m-star ".concat(a<t?"active":"")}));return c.a.createElement("div",null,n)},q=function(e){var t=e.visible,n=e.title,a=e.children;return c.a.createElement("div",{className:"m-dialog-wrap "+(t?"active":"")},c.a.createElement("div",{className:"m-dialog"},c.a.createElement("div",{className:"m-dialog-header"},c.a.createElement("div",{className:"m-dialog-title"},n),c.a.createElement(y,{name:"guanbi",className:"m-dialog-close",onClick:e.onCancel})),c.a.createElement("div",{className:"m-dialog-content"},a),c.a.createElement("div",{className:"m-dialog-footer"},c.a.createElement("button",{className:"m-btn",onClick:e.onCancel},"\u53d6\u6d88"),c.a.createElement("button",{className:"m-btn",onClick:e.onOk},"\u786e\u5b9a"))))},F=function(){return function(e){A.list().then((function(t){200===t.code&&e({type:"SET_STATE",key:"list",value:t.data})}))}},K=function(e,t,n){return function(a){A.myBooks(e,t).then((function(e){200===e.code&&(a({type:"SET_STATE",key:["myBooks"],value:e.data}),n&&n())}))}},U=Object(i.b)((function(e){return{list:e.book.list,currentId:e.book.currentId,isRealScroll:e.book.isRealScroll}}),(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))(Object(S.g)((function(e){var t=e.list,n=e.isRealScroll,o=Object(a.useState)(!1),r=Object(g.a)(o,2),i=r[0],l=r[1],u=Object(a.useState)({checked:!0,count:1,id:1,title:"",avatar:"",price:0,stars:0}),s=Object(g.a)(u,2),m=s[0],f=s[1],d=function(){l(!1)};Object(a.useEffect)((function(){(I=Array.from(document.getElementsByClassName("js-category")).map((function(e){return e.offsetTop}))).push(1/0)}),[e.list]);var E=t.map((function(t){return c.a.createElement("div",{key:t.id,id:t.id+"",className:"js-category"},c.a.createElement("div",{className:"m-category-title"},t.title),t.list.map((function(t){return c.a.createElement("div",{key:t.id,className:"m-list-item",onClick:function(){return n=t.id,void e.history.push("/detail/".concat(n));var n}},c.a.createElement("div",{className:"m-img-wrap"},c.a.createElement("img",{src:t.avatar,alt:t.title,className:"m-img"})),c.a.createElement("div",{className:"m-list-info"},t.title,c.a.createElement(W,{count:t.stars}),c.a.createElement("button",{className:"m-btn",onClick:function(e){return function(e,t){e.stopPropagation(),t.checked=!0,t.count=1,f(t),l(!0)}(e,t)}},"\u6dfb\u52a0")))})))}));return c.a.createElement("div",{className:"m-list",onScroll:function(t){return function(t){var a=t.target.scrollTop+40;if(n)for(var c=0;c<I.length-1;c++)I[c]<=a&&a<I[c+1]&&e.onSetState("currentId",c)}(t)}},E,c.a.createElement(q,{title:"\u6dfb\u52a0",visible:i,onOk:function(){e.onDispatch(K({book:m},"post",d))},onCancel:function(){return d()}},c.a.createElement("div",{className:"m-add-wrap"},c.a.createElement("div",{className:"m-add-info"},c.a.createElement("button",{className:"m-btn",onClick:function(){m.count>1&&(m.count--,f(Object(P.a)({},m)))}},"-"),c.a.createElement("input",{value:m.count,placeholder:"\u6570\u91cf",className:"m-input",onChange:function(e){return function(e){var t=parseInt(e.target.value.replace(/[^\d]/g,""));0===t&&(t=1),m.count=t,f(Object(P.a)({},m))}(e)}}),c.a.createElement("button",{className:"m-btn",onClick:function(){return m.count++,void f(Object(P.a)({},m))}},"+")))))}))),V=Object(i.b)((function(){return{}}),(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))((function(e){return Object(a.useEffect)((function(){e.onDispatch(F())}),[e]),c.a.createElement("div",{className:"m-main m-home"},c.a.createElement(J,null),c.a.createElement(U,null))})),$=function(){return c.a.createElement("div",{className:"m-main"},"\u6211\u7684\u4e66\u5305")},z=function(){return c.a.createElement("div",{className:"m-main"},"\u4e2a\u4eba\u4e2d\u5fc3")},G=Object(i.b)((function(){return{}}),(function(e){return{onSetState:function(t,n){e({type:"SET_STATE",key:t,value:n})},onDispatch:function(t){e(t)}}}))((function(e){var t=function(t,n){return setTimeout((function(){e.onSetState("title",n)})),t};return c.a.createElement("div",{className:"m-wrap"},c.a.createElement(D,null),c.a.createElement(S.d,null,c.a.createElement(S.b,{path:"/index/home",render:function(){return t(c.a.createElement(V,null),"\u5c0f\u7c73\u4e66\u57ce")}}),c.a.createElement(S.b,{path:"/index/my_books",render:function(){return t(c.a.createElement($,null),"\u6211\u7684\u4e66\u5305")}}),c.a.createElement(S.b,{path:"/index/me",render:function(){return t(c.a.createElement(z,null),"\u4e2a\u4eba\u4e2d\u5fc3")}})),c.a.createElement(R,null))})),H=function(e){return Object(a.useEffect)((function(){var t=e.match.params.id;A.getDetail(t).then((function(e){}))}),[e]),c.a.createElement("div",null,"\u8be6\u60c5")},L=function(e){Object(h.a)(n,e);var t=Object(k.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(b.a)(n,[{key:"render",value:function(){return c.a.createElement(S.d,null,c.a.createElement(S.a,{from:"/",to:"/login",exact:!0}),c.a.createElement(S.b,{path:"/login",render:function(e){return c.a.createElement(B,e)}}),c.a.createElement(S.b,{path:"/index",component:G}),c.a.createElement(S.b,{path:"/detail/:id",component:H}))}}]),n}(a.Component);n(69),n(70),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(c.a.createElement(i.a,{store:v},c.a.createElement(l.a,null,c.a.createElement(L,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[41,1,2]]]);
//# sourceMappingURL=main.dcb25c30.chunk.js.map