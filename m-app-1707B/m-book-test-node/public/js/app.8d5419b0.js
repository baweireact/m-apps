(function(t){function e(e){for(var o,r,s=e[0],c=e[1],l=e[2],d=0,p=[];d<s.length;d++)r=s[d],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&p.push(a[r][0]),a[r]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);u&&u(e);while(p.length)p.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],o=!0,s=1;s<n.length;s++){var c=n[s];0!==a[c]&&(o=!1)}o&&(i.splice(e--,1),t=r(r.s=n[0]))}return t}var o={},a={app:0},i=[];function r(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=o,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view"),n("Loading")],1)},i=[],r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"m-loading",class:{active:t.loading}})},s=[],c={computed:{loading:function(){return this.$store.state.loading}}},l=c,u=n("2877"),d=Object(u["a"])(l,r,s,!1,null,null,null),p=d.exports,h={components:{Loading:p}},m=h,f=Object(u["a"])(m,a,i,!1,null,null,null),v=f.exports,y=n("8c4f"),k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],attrs:{type:"text",placeholder:"请输入用户名",autofocus:""},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}})]),n("div",["checkbox"===(t.show?"text":"password")?n("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{placeholder:"请输入密码",type:"checkbox"},domProps:{checked:Array.isArray(t.password)?t._i(t.password,null)>-1:t.password},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleLogin(e)},change:function(e){var n=t.password,o=e.target,a=!!o.checked;if(Array.isArray(n)){var i=null,r=t._i(n,i);o.checked?r<0&&(t.password=n.concat([i])):r>-1&&(t.password=n.slice(0,r).concat(n.slice(r+1)))}else t.password=a}}}):"radio"===(t.show?"text":"password")?n("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{placeholder:"请输入密码",type:"radio"},domProps:{checked:t._q(t.password,null)},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleLogin(e)},change:function(e){t.password=null}}}):n("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{placeholder:"请输入密码",type:t.show?"text":"password"},domProps:{value:t.password},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleLogin(e)},input:function(e){e.target.composing||(t.password=e.target.value)}}}),n("Icon",{attrs:{type:t.show?"xianshimima":"guanbi"},nativeOn:{click:function(e){return t.handleShow(e)}}})],1),n("button",{on:{click:t.handleLogin}},[t._v("登录")])])},g=[],_=(n("498a"),n("d3b7"),n("96cf"),{login:"/api/login",getNav:"/api/nav",getList:"/api/list",getMyBook:"/api/my_book",add:"/api/add",getDetail:"/api/detail",update:"/api/update"}),b=_,w=n("bc3a"),x=n.n(w);x.a.defaults.baseURL="http://localhost:86",x.a.interceptors.request.use((function(t){return t.headers["token"]=localStorage.getItem("username"),t})),x.a.interceptors.response.use((function(t){return 400===t.data.code?alert(t.data.message):403===t.data.code&&(window.location.href="/login"),t}));var S=function(t){var e;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(x()(t));case 2:return e=n.sent,n.abrupt("return",e.data);case 4:case"end":return n.stop()}}))},$={login:function(t){return S({url:b.login,data:t,method:"post"})},getNav:function(){return S({url:b.getNav})},getList:function(t){return S({url:b.getList+t})},getMyBook:function(){return S({url:b.getMyBook})},add:function(t){return S({url:b.add,data:t,method:"post"})},getDetail:function(t){return S({url:b.getDetail+t})},update:function(t){return S({url:b.update,data:t,method:"post"})}},B=$,O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{class:["m-icon icon iconfont icon-"+t.type]})},L=[],j={props:["type"]},C=j,E=Object(u["a"])(C,O,L,!1,null,null,null),D=E.exports,N={data:function(){return{username:"",password:"",show:!1}},components:{Icon:D},methods:{handleLogin:function(){var t=this;this.username.trim()&&this.password.trim()?B.login({username:this.username,password:this.password}).then((function(e){200===e.code&&(localStorage.setItem("username",e.data.username),t.$router.push("/index/home"))})):alert("用户名不能为空！")},handleShow:function(){this.show=!this.show}}},P=N,A=Object(u["a"])(P,k,g,!1,null,null,null),I=A.exports,M=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",[n("router-link",{staticClass:"m-nav-item",attrs:{to:"/index/home"}},[t._v("首页")]),n("router-link",{staticClass:"m-nav-item",attrs:{to:"/index/my_book"}},[t._v("书包")])],1),n("router-view")],1)},H=[],R={},T=R,q=Object(u["a"])(T,M,H,!1,null,null,null),z=q.exports,J=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Nav"),n("List")],1)},U=[],F=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",t._l(t.navList,(function(e){return n("span",{key:e.id,staticClass:"m-nav-item",class:{active:e.id===t.currentId},on:{click:function(n){return t.handleNav(e.id)}}},[t._v(t._s(e.title))])})),0)},G=[],K={computed:{navList:function(){return this.$store.state.navList},currentId:function(){return this.$store.state.currentId}},methods:{handleNav:function(t){this.$store.commit({type:"setState",key:"currentId",value:t}),this.$store.dispatch({type:"getList"})}},mounted:function(){this.$store.dispatch({type:"getNav"}),this.$store.dispatch({type:"getList"})}},Q=K,V=Object(u["a"])(Q,F,G,!1,null,null,null),W=V.exports,X=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",t._l(t.currentList,(function(e){return n("div",{key:e.id,staticClass:"m-list-item"},[n("div",{staticClass:"m-img-wrap"},[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.avatar,expression:"item.avatar"}],staticClass:"m-img"})]),n("div",{staticClass:"m-info"},[t._v(" "+t._s(e.title)+", "),n("button",{on:{click:function(n){return t.handleDetail(e.id)}}},[t._v("详情")]),e.is_in_my_book?n("button",[t._v("已收藏")]):n("button",{on:{click:function(n){return t.handleAdd(e)}}},[t._v("收藏")]),n("Stars",{attrs:{count:e.stars}})],1)])})),0)},Y=[],Z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",t._l(5,(function(e){return n("span",{key:e,staticClass:"m-star icon iconfont icon-iconfontxingxing",class:{active:e<=t.count}})})),0)},tt=[],et={props:["count"]},nt=et,ot=Object(u["a"])(nt,Z,tt,!1,null,null,null),at=ot.exports,it={computed:{currentList:function(){return this.$store.state.currentList}},components:{Stars:at},methods:{handleDetail:function(t){this.$router.push("/index/detail/".concat(t))},handleAdd:function(t){var e=this,n=this.$store.state.myBook;t.count=1,t.checked=!0,n.push(t),this.$store.commit({type:"setState",key:"myBook",value:n}),this.$store.commit({type:"setState",key:"loading",value:!0}),B.add({book:t}).then((function(t){200===t.code&&e.$store.dispatch({type:"getList"})}))}}},rt=it,st=Object(u["a"])(rt,X,Y,!1,null,null,null),ct=st.exports,lt={components:{Nav:W,List:ct}},ut=lt,dt=Object(u["a"])(ut,J,U,!1,null,null,null),pt=dt.exports,ht=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._l(t.myBook,(function(e,o){return n("div",{key:e.id},[n("input",{attrs:{type:"checkbox",id:e.id},domProps:{checked:e.checked},on:{change:function(e){return t.handleChecked(o,e)}}}),n("label",{attrs:{for:e.id}},[t._v(t._s(e.title))]),t._v(" ￥"+t._s(e.price)+" "),n("button",{on:{click:function(e){return t.handleSub(o)}}},[t._v("-")]),t._v(" "+t._s(e.count)+" "),n("button",{on:{click:function(e){return t.handleAdd(o)}}},[t._v("+")]),n("button",{on:{click:function(n){return t.handleDelete(e.id)}}},[t._v("删除")])])})),n("div",[n("input",{attrs:{type:"checkbox",id:"all"},domProps:{checked:t.total.selectedAll},on:{change:t.handleSelectAll}}),n("label",{attrs:{for:"all"}},[t._v("全选")]),n("button",{on:{click:t.handleShowDialog}},[t._v("删除")])]),n("div",[t._v("总价：￥"+t._s(t.total.totalPrice)+"，总数："+t._s(t.total.totalCount))]),n("Dialog",{attrs:{visible:t.visible,title:"删除"},scopedSlots:t._u([{key:"footer",fn:function(){return[n("button",{on:{click:t.handleHideDialog}},[t._v("取消")]),n("button",{on:{click:t.handleDeleteSelected}},[t._v("确定")])]},proxy:!0}])},[n("div",[t._v(" 你确定要删除选中的图书吗？ ")])])],2)},mt=[],ft=(n("4de4"),n("c740"),n("4160"),n("a434"),n("159b"),n("2909")),vt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"m-dialog-wrap",class:{active:t.visible}},[n("div",{staticClass:"m-dialog"},[n("div",{staticClass:"m-dialog-title"},[t._v(t._s(t.title))]),n("div",{staticClass:"m-dialog-content"},[t._t("default")],2),n("div",{staticClass:"m-dialog-footer"},[t._t("footer")],2)])])},yt=[],kt={props:["visible","title"]},gt=kt,_t=Object(u["a"])(gt,vt,yt,!1,null,null,null),bt=_t.exports,wt={data:function(){return{visible:!1}},computed:{myBook:function(){return console.log("更新"),this.$store.state.myBook},total:function(){var t=0,e=0,n=this.$store.state.myBook;n.filter((function(t){return t.checked})).forEach((function(n){e+=n.count,t+=n.count*n.price}));var o=n.filter((function(t){return t.checked})).length;return{totalPrice:t,totalCount:e,selectedAll:o===n.length&&n.length>0}}},components:{Dialog:bt},methods:{handleDelete:function(t){var e=this.myBook.findIndex((function(e){return e.id===t}));this.myBook.splice(e,1),this.$store.commit({type:"setState",key:"myBook",value:Object(ft["a"])(this.myBook)})},handleAdd:function(t){this.myBook[t].count++,this.$store.commit({type:"setState",key:"myBook",value:Object(ft["a"])(this.myBook)})},handleSub:function(t){this.myBook[t].count>1&&(this.myBook[t].count--,this.$store.commit({type:"setState",key:"myBook",value:Object(ft["a"])(this.myBook)}))},handleChecked:function(t,e){var n=this.myBook;n[t].checked=e.target.checked,this.$store.commit({type:"setState",key:"myBook",value:Object(ft["a"])(n)})},handleSelectAll:function(t){var e=this.myBook;e.forEach((function(e){e.checked=t.target.checked})),this.$store.commit({type:"setState",key:"myBook",value:Object(ft["a"])(this.myBook)})},handleDeleteSelected:function(){var t=this.myBook;t=t.filter((function(t){return!t.checked})),this.$store.commit({type:"setState",key:"myBook",value:Object(ft["a"])(t)}),this.handleHideDialog()},handleShowDialog:function(){this.visible=!0},handleHideDialog:function(){this.visible=!1}},updated:function(){this.$store.dispatch({type:"update"})},mounted:function(){this.$store.dispatch({type:"getMyBook"})}},xt=wt,St=Object(u["a"])(xt,ht,mt,!1,null,null,null),$t=St.exports,Bt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("img",{attrs:{src:t.detail.avatar}}),n("div",[t._v(" "+t._s(t.detail.summary)+" ")]),n("div",[t.detail.is_in_my_book?n("button",[t._v("已收藏")]):n("button",{on:{click:function(e){return t.handleAdd(t.detail)}}},[t._v("收藏")])])])},Ot=[],Lt={data:function(){return{detail:{}}},methods:{handleAdd:function(t){var e=this;t.count=1,item.checked=!0,B.add({book:t}).then((function(t){200===t.code&&(e.detail.is_in_my_book=!0)}))}},mounted:function(){var t=this,e=this.$route.params.id;B.getDetail("?id=".concat(e)).then((function(e){200===e.code&&(t.detail=e.data)}))}},jt=Lt,Ct=Object(u["a"])(jt,Bt,Ot,!1,null,null,null),Et=Ct.exports;o["a"].use(y["a"]);var Dt=[{path:"/",redirect:"/login"},{path:"/login",component:I},{path:"/index",component:z,children:[{path:"/index/home",component:pt},{path:"/index/my_book",component:$t,meta:{needLogin:!0}},{path:"/index/detail/:id",component:Et,meta:{needLogin:!0}}]}],Nt=new y["a"]({mode:"history",base:"/",routes:Dt});Nt.beforeEach((function(t,e,n){t.meta.needLogin?localStorage.getItem("username")?n():n({path:"/login"}):n()}));var Pt=Nt,At=n("2f62");o["a"].use(At["a"]);var It=new At["a"].Store({state:{navList:[],currentId:0,currentList:[],myBook:[],loading:!1},mutations:{setState:function(t,e){t[e.key]=e.value}},actions:{getNav:function(t){var e=t.commit;B.getNav().then((function(t){200===t.code&&e({type:"setState",key:"navList",value:t.data})}))},getList:function(t){var e=t.commit,n=t.state,o=n.currentId;e({type:"setState",key:"loading",value:!0}),B.getList("?id=".concat(o)).then((function(t){200===t.code&&(e({type:"setState",key:"currentList",value:t.data}),e({type:"setState",key:"loading",value:!1}))}))},getMyBook:function(t){var e=t.commit;e({type:"setState",key:"loading",value:!0}),B.getMyBook().then((function(t){200===t.code&&(e({type:"setState",key:"myBook",value:t.data}),e({type:"setState",key:"loading",value:!1}))}))},update:function(t){var e=t.state;B.update({myBookNew:e.myBook}).then((function(t){}))}},modules:{}}),Mt=n("caf9");n("cbcd"),n("a766"),n("ef03");o["a"].config.productionTip=!1,o["a"].use(Mt["a"],{}),new o["a"]({router:Pt,store:It,render:function(t){return t(v)}}).$mount("#app")},a766:function(t,e,n){},cbcd:function(t,e,n){},ef03:function(t,e,n){t.exports=n.p+"img/loading.01096fe5.gif"}});
//# sourceMappingURL=app.8d5419b0.js.map